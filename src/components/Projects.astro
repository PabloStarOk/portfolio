---
import SectionLayout from "@/layouts/SectionLayout.astro";
import { getCollection } from "astro:content";
import ProjectCard from "./projects/ProjectCard.astro";

const thumbnailImports = import.meta.glob<{ default: ImageMetadata }>(
  "/src/assets/projects/*.webp",
  { eager: true }
);

const projectsCollection = await getCollection("projects");

// Validate thumbnail paths
projectsCollection.forEach(({ id, data }) => {
  const path = `/src/assets/projects/${data.thumbnail.fileName}`;
  if (!thumbnailImports[path])
    throw new Error(
      `File name \"${data.thumbnail.fileName}\" given in \"${id}\" doesn't exist.`
    );
});

// Display only featured projects
const featuredProjects = projectsCollection.filter(
  ({ data }) => data.featuredProject
);
---

<SectionLayout id="projects" title="Proyectos">
  {
    featuredProjects.map(({ slug, data }) => {
      const path = `/src/assets/projects/${data.thumbnail.fileName}`;
      return (
        <ProjectCard
          name={data.name}
          description={data.shortDescription}
          href={`/projects/${slug}-project`}
          thumbnailSrc={thumbnailImports[path].default}
          thumbnailAlt={data.thumbnail.alt}
        />
      );
    })
  }
</SectionLayout>
